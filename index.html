<!DOCTYPE html>
<meta charset="utf-8" />
<title>WebSocket Test</title>
<script language="javascript" type="text/javascript">
  var wsUri = "ws://10.0.0.5:8080/";
  var output; 
  function init() {
    websocket = new WebSocket(wsUri);
    websocket.onmessage = function (evt) { onMessage(evt) };
  }
  function updateFSM() {
      var time = new Date().getTime();
      var imgElement = document.getElementById("statemachinepic");
      imgElement.src= "http://10.0.0.5/pic" + time; // + Math.round(time/1000).toString();
  }
  function onMessage(evt) {
    var lastupdate = document.getElementById("lastupdate");
    var prevupdate = document.getElementById("prevupdate");
    prevupdate.innerHTML = lastupdate.innerHTML; 
    lastupdate.innerHTML = evt.data + "at time: "+ new Date().getTime();
    //updateFSM();
  }
  window.setInterval( function () {
      updateFSM();
  },4000);
  window.addEventListener("load", init, false);
</script>

<h2>WebSocket Test</h2>  
<div id="output"></div> 
<img src="/pic"/ id="statemachinepic">
<div id="lastupdate"> Last update </div>
<div id="prevupdate"> Previous update </div>
</html>

<!DOCTYPE html>
<meta charset="utf-8" />
<title>WebSocket Test</title>
<script language="javascript" type="text/javascript">

  var ip = 'localhost';
  var wsUri = "ws://"+ip+":8080/";
  var output; 
  function init() {
    websocket = new WebSocket(wsUri);
    websocket.onmessage = function (evt) { onMessage(evt) };
  }
  function updateDagre() {
    var r = new XMLHttpRequest();
    r.open("GET", "/graph", true);
    r.onreadystatechange = function () {
       if (r.readyState != 4 || r.status != 200) return;
       var graphJson = JSON.parse(r.responseText);
       var g = dagreD3.json.decode(graphJson.nodes, graphJson.edges);
       var renderer = new dagreD3.Renderer();
       renderer.run(g, d3.select("svg g"));
     };
     r.send();
  }

 function onMessage(evt) {
    var lastupdate = document.getElementById("lastupdate");
    var prevupdate = document.getElementById("prevupdate");
    prevupdate.innerHTML = lastupdate.innerHTML; 
    lastupdate.innerHTML = evt.data + " at time: "+ new Date().getTime();
  }
  window.setInterval( function () {
      updateDagre();
  },1000);
  window.addEventListener("load", init, false);
</script>
<script src="/d3"></script>
<script src="/dagred3"></script>
<style>
svg {
    overflow: hidden;
}

.node rect {
    stroke: #333;
    stroke-width: 1.5px;
    fill: #fff;
}

.edgeLabel rect {
    fill: #fff;
}

.edgePath {
    stroke: #333;
    stroke-width: 1.5px;
    fill: none;
}
</style>

<h2>WebSocket Test</h2>  
<svg width=1250 height=680>
    <g transform="translate(20,20)"/>
</svg>

<div id="output"></div> 
<div id="dagretest"> Dagreetst</div>
<div id="lastupdate"> Last update </div>
<div id="prevupdate"> Previous update </div>
</html>
